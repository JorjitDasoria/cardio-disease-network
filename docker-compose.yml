version: '3.8'

services:
  # --- Service 1: Python Backend ---
  backend:
    build: ./backend-bayesian
    container_name: cardio_backend
    ports:
      - "8000:8000"  # Maps localhost:8000 to container:8000
    env_file:
      - ./backend-bayesian/.env  # Loads your API Keys automatically
    volumes:
      - ./backend-bayesian:/app  # Live reload: Changes in code reflect instantly
    command: uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload

  # --- Service 2: React Frontend ---
  frontend:
    build: ./frontend-ui
    container_name: cardio_frontend
    ports:
      - "3000:3000"  # Maps localhost:3000 to container:3000
    volumes:
      - ./frontend-ui:/app
      - /app/node_modules  # Prevent node_modules from being overwritten
    environment:
      - CHOKIDAR_USEPOLLING=true # Fixes hot-reload issues on Windows
    depends_on:
      - backend # Waits for backend to start
    stdin_open: true # Required for React to exit/run correctly in Docker
    tty: true